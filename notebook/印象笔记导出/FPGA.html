<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, MWS); Windows/10.0.15063 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="777"/>

<div>
<span><div>基于 FPGA 和 USB3.0 的高速 CMOS 图像采集系统设计</div><div>高速采集和实时传输分别是高速数据采集的两个主要研究内容，其中</div><div>FPGA 发展为数据的高速采集和存储提供了更好的解决方法，同时 USB3.0 高速接</div><div>口的广泛应用为高速数据实时传输提供了一个新型可行的解决方案。</div><div><br/></div><div><br/></div><div>通过接收多路CMOS图像高速输入信号，利用DDR2</div><div>模块进行数据高速缓存，通过 FPGA 主控芯片控制 USB3.0 接口芯片进行高速数</div><div>据的传输，将图像数据传送至上位机进行显示</div><div><br/></div><div>V7670 传</div><div>感器。该传感器既支持黑白也支持彩色图像输出，芯片尺寸为 1/3 英寸。最高</div><div>像素为 664x492，输出图像的有效像素为 640x480。最大帧频为 30f/s，可以选</div><div>择 YUV、YCrCb、RGB 三种格式的任意一种输出。内置 A/D 转换器为 10bit，支持</div><div>双通道，图像输出接口位宽是 8 位</div></span>
</div>
<hr>
<a name="778"/>

<div>
<span><div align="justify" style="min-height: 13pt;"><div><span style="font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(204, 0, 0);">背景知识：：</span></span></span></div><div><span style="font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(204, 0, 0);"><br/></span></span></span></div><div><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">1280*1024</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);"> </span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">分辨率</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">说的是显示器上的</span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">像素</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">点数量，横向 1280 个</span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">像素</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">点，纵向 1024 个</span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">像素</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">点。</span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">像素</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">点合计 </span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">1280*1024</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">=1310720 个</span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">像素</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">点。</span></div><div><span style="font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(51, 51, 51);"><br/></span></span></span></div><div><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 70, 53);"><b>24 位真彩色</b></span>说的是每个</span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">像素</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">点表示颜色的方法采用 RGB 三原色表示法，即每个</span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">像素</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">点用红、绿、蓝三种颜色的混杂量调制出不同颜色，R、G、B 分辨用 8 位二进制数字表示颜色的多少。即，一个</span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">像素</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">点8*3=24位</span><br style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">亦即 </span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">1280*1024</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);"> </span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">的</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">单帧画面，无压缩</span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">的数据</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">量应为：</span><br style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">像素</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">点数量=</span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">1280*1024</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">=1310720 个</span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">像素</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">点</span><br style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">单</span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">像素</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">点大小=8*3=24 位/个</span><em style="color: rgb(204, 0, 0); font-style: normal; font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">像素</em><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">点</span></div><div><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">单帧画面总大小=1310720*24=31,457,280 位</span></div><div><span style="font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif;"><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(51, 51, 51);"><br/></span></span></span></div><div><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">1 字节=8 位 ==》</span></div><div><span style="color: rgb(51, 51, 51); font-family: arial, 'pingfang sc', stheiti, simsun, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">单帧画面总大小=31,457,280/8=3932160 字节=3840 KB=3.75 MB</span></div><div><b><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></b></div><div><b><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></b></div><div><b><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></b></div><div><b><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></b></div><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt"><b>电子学系统方案设计</b></span></font></div><div><b><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></b></div></div><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">根据多光谱相机的技术规格和任务要求，电子学硬件系统由电源管理单元、控制采集单元、<b>FLASH存储器</b>、<b>MicroSD存储器</b>、<b>USB2.0控制与传输单元</b>、<b><span style="color: rgb(186, 0, 255);">RS232通信单元</span></b>组成，结构如图1所示。</span></font></div><div><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div></div><div align="center" style="min-height: 240pt;"><img src="FPGA_files/Image.png" type="image/png" alt="graphic" border="0" height="321" style="height: auto;" width="554"/></div><div align="center" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">图1 多光谱相机电子学系统组成</span></font></div><div><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt"><b>控制与采集单元</b>的主要功能包括：</span></font></div><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 36pt; margin-right: 0pt; padding-left: 3pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">通过<span style="color: rgb(235, 0, 115);"><b>SPI与CMOS探测器通信，加载CMOS控制参数并回读，接收CMOS探测器的LVDS图像信号</b></span>；</span></font></div></li><li style="margin-left: 36pt; margin-right: 0pt; padding-left: 3pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">将<span style="color: rgb(235, 0, 115);"><b>图像信号进行格式处理</b></span>后，<b>存储至MicroSD卡</b>；</span></font></div></li><li style="margin-left: 36pt; margin-right: 0pt; padding-left: 3pt; text-indent: 0pt;"><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">通过<b><span style="color: rgb(235, 0, 115);">USB接口与上位机</span></b>进行通信，<span style="color: rgb(235, 0, 115);"><b>接收上位机的控制参数，同时将参数和图像数据传送至上位机（</b></span></span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">实时传输探测器视频图像</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal"><span style="color: rgb(235, 0, 115);"><b>）</b></span></span></font></div></li><li style="margin-left: 36pt; margin-right: 0pt; padding-left: 3pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">通过RS232接口与GPS模块通信，并将位置与姿态信息与图像打包，存储至MicroSD卡；（问一嘴）</span></font></div><div align="justify" style="min-height: 13pt;"><br/></div></li></ol><div style="margin-left: 36pt; margin-right: 0pt; padding-left: 3pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><span style="font-family: ����;"><br/></span></div><div style="margin-left: 36pt; margin-right: 0pt; padding-left: 3pt; text-indent: 0pt;"><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt"><b>探测器选型：</b></span></font></div><div align="justify" style="min-height: 14pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">拟选用ON</span></font> <font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Semiconductor</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">公司的</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">PYTHON</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">系列 130万像素彩色CMOS图像探测器</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">NOIP3SE1300A−QDI</span></font><div align="justify" style="min-height: 13pt;"><div><span style="color: rgb(235, 0, 115);"><b><font face="宋体" size="2"><span style="font-size:10pt">所选探测器为2路LVDS输出。</span></font></b></span></div></div></div><div style="margin-left: 15mm;"><table cellpadding="0" cellspacing="0" style="border-collapse: collapse; border-width: 1px; border-color: #010101;width:470px;" width="425"><tr><td align="left" style="border: solid #010101 1px;width:54.25531914893617%;" valign="top" width="207"><div align="justify" style="min-height: 12pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Parameter Specification</span></font></div></td><td align="left" style="border: solid #010101 1px;width:45.95744680851064%;" valign="top" width="216"><div align="justify" style="min-height: 12pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">1280 (H) x 1024 (V)</span></font></div></td></tr></table></div><div><span style="font-family: Calibri;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt"><b>USB控制器设计：</b></span></font></div><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">1.本设计选用CYPRESS公司的USB控制芯片CY7C68013。</span></font><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">可使用4 种USB 传输方式：控制传输、中断传输、批量传输和同步传输。</span></font><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">芯片固件是存储在主机上而不是在芯片。</span></font></div><div><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">2.CY7C68013A 特点：</span></font></div><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">程序可通过下面方式下载：</span></font></div></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－ 通过USB 口下载</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－ 通过外部E2PROM 装载</span></font></div><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－ 外界存储设备(只有128 引脚封装支持)</span></font></div><div><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div></div><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">3、<span style="color: rgb(235, 0, 115);"><b>通用可编程接口GPIF</b></span>，GPIF 是FX2 一个重要技术：</span></font></div></div><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－可设置为主从模式，主模式下可对外部FIFO、存储器、ATA接口设备进行高速读写操作，<b>从模式下外部主控器(如DSP,MCU)可把GPIF 端口当作FIFO 进行高速读写操作。</b></span></font></div></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－ 支持与外设通过并行8 位或16 总线传输。</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－ 支持通过GPIF 编程工具编程，灵活产生各种波形。</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－ 支持多CTL 输出和多RDY 输入。</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">4、增强工业级8051 内核，特点有</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－ 支持48M 时钟</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－</span></font> <font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">4</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">个时钟指令周期，在时钟为</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">48M</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">时，单指令执行时间为</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">83.3ns</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">两个</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">UART</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">三个</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">TIMER</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">多中断系统</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">多数据指针</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">5</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">、</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">3.3V</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">工作电压，低功耗，在任何工作模式下电流小于</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">85mA</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">。</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">6</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">、智能串行接口引擎</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">(SIE)</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">。</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">7</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">、</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">USB</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">中断矢量。</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">8</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">、</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">100KHZ</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">或</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">400KHZ I2C</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">接口。</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">9</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">、</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">4</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">个集成</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">FIFO</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">低成本与外设实现</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">“</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">胶连接</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">”</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">自动实现从</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">16</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">位</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">FIFO</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">转换</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">支持主从工作模式</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－</span></font> <font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">FIFO</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">支持内外时钟和同步数据触发</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">－</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">轻松实现与</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">ASIC,DSP</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">连接</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">10</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">、包括</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">40</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">多个通用</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">IO</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">端口。</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">11</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">、</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">4</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">中可选封装－</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">56</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">引脚</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">SSOP</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">和</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">QFN</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">，</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">100</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">引脚</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">TQFP</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">和</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">128</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">引脚</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">TQFP</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">。</span></font></div><div align="center" style="min-height: 180pt;"><img src="FPGA_files/Image [1].png" type="image/png" alt="graphic" border="0" height="241" style="height: auto;" width="454"/></div><div align="center" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">图5 CY7C68013芯片框架图</span></font></div><div><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt"><b>RS232通信接口设计：</b></span></font></div><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">RS-232通信接口用于<span style="color: rgb(255, 70, 53);"><b>接收GPS模块发送的位置坐标信息和无人机姿态信息，并将其与图像数据打包存储至SD卡中</b></span>。接口芯片选择型号为MAX3228E的RS232收发芯片。</span></font></div><div><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt"><b>MicroSD卡电路设计：</b></span></font></div><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">    MicroSD卡有<span style="color: rgb(255, 70, 53);"><b>8个引脚和2种操作模式</b></span>，其引脚排序和不同模式下定义的如图8所示。</span></font></div></div><div align="center" style="min-height: 184pt;"><img src="FPGA_files/Image [2].png" type="image/png" alt="http://hi.csdn.net/attachment/201202/21/0_1329837952Fjmv.gif" border="0" height="246" style="height: auto;" width="551"/></div><div align="center" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">图8 MicroSD卡引脚定义</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">   <span style="color: rgb(255, 70, 53);"><b> SD 卡主要引脚和功能为</b></span>：</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">    CLK：时钟信号，<b>每个时钟周期传输一个命令或数据位</b>，频率可在<b>0～25MHz</b>之间变化，SD卡的总线管理器可以不受任何限制的自由产生0～25MHz 的频率；</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">    CMD：双向命令和回复线，<b>命令是一次主机到从卡操作的开始</b>，命令可以是从主机到单卡寻址，也可以是到所有卡；<b>回复是对之前命令的回答</b>，回复可以来自单 卡或所有卡；</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">    DAT0～3：数据线，数据可以<b>从卡传向主机</b>也可以<b>从主机传向卡</b>。</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt;"><div><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt"><span style="color: rgb(255, 70, 53);"><b>SD卡以命令形式来控制SD卡的读写等操作。可根据命令对多块或单块进行读写操作</b></span>。在SPI模式下其命令由6个字节构成，其中高位在前。</span></font></div></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">一般低速卡通常支持0~400Kbs 数据传输率，采用SPI和1位SD传输模式。高速卡支持0~100Mbs数据传输率，采用4位SD传输模式。<b>本应用中一帧完整数据约为2.6MB，因此需采用4位SD传输模式。</b></span></font></div></div><div><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div></div><div><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt"><b>FLASH电路设计（术语有毛病）：</b></span></font></div></div><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt"><b>    </b></span><span style="font-size:10pt">由于FPGA要完成CMOS视频图像采集和图像格式的转换算法(跑程序所占用的内存)，FPGA内部RAM容量有限（2586Kb），故本设计选用Micron公司的<b>SDRAM存储器</b></span></font><b><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">MT48LC16M16A2FG</span></font></b><font color="#010101" face="宋体" size="2"><span style="font-size:10pt"><b>，形成数据缓存单元（<span style="color: rgb(255, 70, 53);">暂存图像数据，但是本方案采用DDR3内存缓存方式</span>）</b>。</span></font></div></div><div><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div></div></div></div></div></div></div></div></div></div></span>
</div>
<hr>
<a name="785"/>

<div>
<span><div><span style="font-size: 19px;"><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">FPGA 的 LVDS 的数据发送和接收</span></b></span></div><div><br/></div><div><span style="color: rgb(93, 218, 255);"><span style="font-size: 15px;"><span style="font-family: 微软雅黑, Bold; font-style: normal; font-variant: normal;"><b>LVDS （</b></span> <b><span style="font-family: 微软雅黑; font-style: normal; font-variant: normal;">低电压差分信号</span><span style="font-family: 微软雅黑, Bold; font-style: normal; font-variant: normal;">）介绍</span></b></span></span></div><div><b><br/></b></div><div><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">背景：当今主控芯片的引脚<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">资源相对变得紧俏；在数字系统互联的设计中，并行传输的方式将会被高速串行传输逐步<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">替代。</span></span></span></div><div><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">而在串行传输标准中，低电压差分信号传输（ LVDS）接口具有高速率、低功耗、低<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">噪声和低电磁干扰等优点，广泛应用于高速数字系统设计中。</span></span></span></span></div><div><b><br/></b></div><div><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">低压差分信号：</span></b></div><ul><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">相对于单端的传送具有较高的噪声抑制功能</span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">较低的电压摆幅允许差<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">分对线具有较高的数据传输速率，消耗较小的功率以及产生更低的电磁辐射。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">由于差分的缘故，所以输入和输出都各使用两条线。</span></span></li></ul><div><br/></div><div><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">详见《LVDS 原理与应用简介》</span></div><div><br/></div><div><br/></div><div><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">解决：为了适用于高速通讯的场合，现在的 FPGA 都提供了数目众多的 LVDS 接口。</span></div><div><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">举例：SPARTAN-6 FPGA 芯片的 IO 口支持不同电压的 LVDS 数据传输，具体每个 BANK 能够实<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">现的电平标准请大家参考&quot;Spartan-6 FPGA SelectIO Resources User Guide.pdf&quot;的表<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">1-5。</span></span></span></span></div><div><b><br/></b></div><div><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">在AX545/AX516 开发板的扩展口 J3 的信号连接到 FPGA 的 Bank2 上，属于LVDS接口。</span></b></div><div><b><br/></b></div><ul><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">在硬件设计上<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">我们已经考虑到 LVDS 的信号的数据传输，所以在 PCB 走线的时候使用等长并且 100ohm<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">的差分对走线；</span></span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">另外IO的电压通过电阻跳变来实现 3.3V 和 2.5V 的切换。所以用户能实现<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">不同电压的 LVDS 的高速数据通信。</span></span></span></span></li></ul><div><br/></div><div><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">我们以开发板上的扩展口 J3 的差分信号来实现 LVDS 的环路数据通信。且</span><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">这里发送和接收都只使用了一对 LVDS 数据和一对 LVDS 时钟。</span></b></div><div><br/></div><ul><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">发送的 LVDS 时钟在开发<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">板上 <b>环路到 </b>接收的 LVDS 时钟，发送的 LVDS 数据 <b>环路到 </b>接收的 LVDS 数据。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">LVDS 的发送<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">数据和发送时钟由 FPGA 内部产生，我们可以通过 chipscope 来查看 LVDS 接收到的数据是<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">否和发送的数据一致。</span></span></span></span></li></ul><div><span style="font-size: 12pt;"><br/></span></div><div><span style="color: rgb(93, 218, 255);"><span style="font-size: 15px;"><b>程序设计</b></span></span></div><div><br/></div><div><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">SPARTAN6 FPGA 中已集成了 SelectIO 资源（属于IP核）。</span></b></div><div><b><br/></b></div><ol><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">通过配置 IP 核，可以生成支持<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">LVDS 电平标准的接口程序，实现高速 LVDS 接口通信。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">SelectIO 资源包含了 ISERDESE2、<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">OSERDESE2、 IDELAYE2、 ODELAYE2、 IDELAYCTRL 等， 本设计中仅用到 <b>ISERDESE2 和</b><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><b>OSERDESE2</b>。</span></span></span></span></li></ol><ul><li style="display:inline;list-style:none;"><ul><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">ISERDESE 为 Xilinx FPGA 中专用的<b>解串器</b>，主要用于数字传输中的<b>串行转并</b><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><b>行</b>， 先到的比特为为高位。</span></span></span></span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">OSERDESE2 为<b>转串器</b>，主要用于数字传输中的<b>并行转串行</b>，<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">先到的比特为为高位。</span></span></span></span></span></span></li></ul></li></ul><div><br/></div><div><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">FPGA 中 ISERDESE2 和 OSERDESE2 支持非常高的 I/O 数据速率。</span></span></span></span></span></span></span></b></div><div><br/></div><ul><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">对于 ISERDESE2 存<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">在 <b>bitslip 信号</b>来重新对齐串行数据以获得正确的字节数据；</span></span></span></span></span></span></span></span><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">使用 bitslip 信号可以修改串转并的起始位置；</span><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">通过多次插入 bitslip 的方法来获取正确的并行数据序。</span></li></ul><div><br/></div><div><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><b>SelectIO IP 核的建立流程</b>：</span> <span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">一个用于并行<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">数据转成串行数据并通过 LVDS 差分输出； 另一个用于 LVDS 差分输入转换成并行数据。</span></span></div><div><br/></div><div><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">以SPARTAN-6为例：</span></span><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">并行<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">数据转成串行数据</span></span></b></div><ol><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">向项目中添加一个 new source, 在 New Source Wizard 的向导里选择 IP(CORE<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">Generator &amp; Architecture Wizard)。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">选择 FPGA Features and Design/IO Interfaces/SelectIO Interface Wizard。</span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">在 SelectIO Interface 向导中 Data Bus Direction 项选择 Configure outputs from<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">device。这里我们选择数据方向为输出。 IO 信号选择选择差分， LVDS33 电平。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">勾选 Use serialization。 Serialization factor 为 8，它的意思是 8 位并行数据转化为</span><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">1 个串行数据。 External data Width 设为 <b>1</b>，它的意思是输出的数据为串行数据（ 1 个差分<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">对）。另外使能 Enable Clock Forwarding 项， 来产生输出的 LVDS 差分时钟。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">不设置输入延时。<br/></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">设置时钟输入为单端的 LVCOMS33 电平， 本例中该输入的时钟为系统时钟 50Mhz。<br style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"/></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">不设置输出延时。</span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">点击 Generate 按钮完成 selectio IP 的配置。</span></li></ol><div><br/></div><div><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><b>实现：</b></span></div><ul><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><b>使用两个OSERDES2（由于一个OSERDES2是4位转串行，所以需要两个实现；其中一个是MASTER，另一个是SLAVE）。</b></span><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><b>然后调用 OBUFDS 来实现 OSERDES2 输出的单端信号转换成差分信号进行输出。</b></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><b>使用两个ISERDES2（由于一个ISERDES2是4位转串行，所以需要两个实现；其中一个是MASTER，另一个是SLAVE）。</b></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">我们只是使用了 <span style="color: rgb(93, 218, 255);"><b>1</b></span><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(93, 218, 255);"><b>路</b></span>的数据来为大家演示 LVDS 发送和接收，用户在实际使用中用同样的方法来实现<span style="color: rgb(93, 218, 255);"><b>多路</b></span><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">LVDS 数据的传输。<br style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webki"/></span></span></span></li></ul><div><br/></div><div><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">以SPARTAN-6为例：<b>串</b></span></span><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">行<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">数据转成并行数据</span></span></b></div><ol><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">向项目中添加一个 new source, 在 New Source Wizard 的向导里选择 IP(CORE<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">Generator &amp; Architecture Wizard)。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">选择 FPGA Features and Design/IO Interfaces/SelectIO Interface Wizard。</span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">在 SelectIO Interface 向导中 Data Bus Direction 项选择 Configure inputs from<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">device。这里我们选择数据方向为输入。 IO 信号选择选择差分， LVDS33 电平。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">勾选 Use serialization。 Serialization factor 为 8，它的意思是每 8 位串行数据转化为一个8位并</span><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">行数据。 External data Width 设为 <b>1</b>，它的意思是</span> <span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">连接的外部设备输入进来<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">的数据引脚为 1 个差分对。</span></span><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">另外使能 Enable BITSLIP 项， 需要使用其作为输出数据对齐。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">不设置输入延时。<br/></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">设置时钟输入为差分的 LVDS33 电平， 本实验这个差分时钟从 FPGA 外部输入。</span><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><br style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"/></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">不设置输出延时。</span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">点击 Generate 按钮完成 selectio IP 的配置。</span></li></ol><div><br/></div><div>详见 <span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">“SERDES_FPGA 设计手册”</span></div><div><span style="font-size: 12pt;"><br/></span></div><div><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">LVDS 发送和接收的测试程序 lvds_test.v。在这个文件里产生<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">LVDS 测试数据并实例化 LVDS 的发送和接收的 IP。</span></span></b></div><div><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">实现 LVDS 的数据发送和数据接收的功能。</span></span></b></div><div><b><br/></b></div><ul><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">因为串行转成并行的时候，输出的数据无法判断哪个 Bit 是高位，哪个 bit 是低位， 程序<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">中我们会判断输入的数据是否等于 0x80(这个值我们自己设定） , 再判断下一个数据是否为<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">0x81, 如果不是说明数据的排列有错，产生一个时钟周期的 BITSLIP 的脉冲, 提供给 s_to_p<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">的 BITSLIP 输入端， 来调整串转并输入数据的起始位置， 直到数据正确加 1 为止。</span></span></span></span></li></ul><div><br/></div><div><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">编写工程的管脚约束文件 lvds_test.ucf</span></b></div><div><b><br/></b></div><div><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="font-size: 9pt;"><i>DIFF_TERM = &quot;TRUE&quot;</i></span>   </span><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">注：LVDS 的输入约束需要加差分端接电阻为 True, 因为开发板上没有加 100 欧姆的差<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">分电阻，所以需要使能 FPGA 内部的差分端接电阻。</span></span><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">FPGA 内部的端接电阻的详细说明可以参<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">考“Spartan-6 FPGA SelectIO Resources User Guide.pdf”的 Page15。</span></span></span></div><div><br/></div><div><b>仿真文件 <span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">vtf_lvds_test.v</span></b></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">程序里我们把 LVDS 的输出时钟付给了 LVDS 的输入时钟，把 LVDS 的输出<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">数据付给了 LVDS 的输入数据。就相当于模拟了 LVDS 信号在 FPGA 外部的环路连接。</span></span></div></span>
</div>
<hr>
<a name="786"/>

<div>
<span><ul><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">Spartan6 FPGA 芯片中集成了 <b>MCB 硬核，</b><b>支持到 DDR3；</b>而且对于大多数厂家<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">的存储芯片都支持（ Micron、 Elpida、 Hynix.....）。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">对于工程来讲，MCB 硬核 优秀的误码<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">校验和偏移时钟校验，以及 PLL_ADV 工作时的稳定、高精度都大大保证了研发产品的质量。</span></span></span></li></ul><div><br/></div><ul><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">Xilinx ISE 提供了 <b>MIG IP 核</b>，<b>直接生成 DDR3 控制器设计模块。</b>模块包含可<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">自由修改的 HDL 源代码和约束文件。</span></span></span></span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">用户可以在 MIG 的 GUI 图形界面根据所选的存储器件<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">选择对应模板、总线宽度和速度级别，并设置 CAS 延迟、突发长度、引脚分配等关键参数。<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">如果所选器件与 MIG 所列模板不相符，可在代码生成后灵活修改这些代码。</span></span></span></span></span></span></span></li></ul><div><br/></div><div><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">本例 用 MIG 工具生成 DDR3 控制器，并用<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">ChipScope 测试 DDR3 读写数据的方法。</span></span></b></div><ul><li>MIG IP 控制器是 Xilinx 为用户提供的一个 DDR 控制的 IP, 这样用户即使不了解 DDR 的控制和读写时序也能通过 MIG 控制器方便的读写 DDR 存储器。</li></ul><div><br/></div><div><b>因为 Spartan6 FPGA 和 DDR3 连接是 MCB 硬核，故只有 Bank1 或 Bank3 能够和 DDR3相连接；另外，连接的管脚也是固定的、用户不能随便连接。</b></div><div><b><br/></b></div><div><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">AX516/AX545 开发板上都使用了 <b>Micron DDR3颗粒</b>。</span></div><div><br/></div><ul><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">AX516 开发板上使用的是容量<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">为 1Gb 的 MT41J64M16。</span></span></li><li><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">AX545 开发板上使用的是 2Gb 的 MT41J128M16。</span></span></b></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><b>DDR3 和 FPGA</b><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><b>之间的连接的数据宽度都为 16 位。</b>另外开发板板上对 DDR3 的地址线和控制线都做 端接电<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">阻上拉到 VTT 电压, 保证信号的质量。</span></span></span></span></li></ul><div><b><br/></b></div><div><b>步骤：</b></div><ol><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">打开 Xilinx CORE Generator System</span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">双击 IP Catalog 界面中的 MIG Vertex6 and Spartan6 3.92 启动 MIG IP 的生成和配置<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">工具。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">如果这个 MIG IP 只是针对 AX516 开发板上的 XC6SLX16 的话，这里就不需要选择 Pin<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">Compatible 的 FPGA。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">我们选择 Bank3 连接 DDR3 SDRAM，因为开发板上 DDR3 是连接到 FPGA 的<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">Bank3 上的。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">设置 DDR3 的时钟频率为 312.5Mhz, 这个频率最高可设置为 333.33Mhz，我们这里稍微<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">留一点余量。 另外 DDR3 的型号设置为跟开发板上一致的型号 MT41J64M16XX-187E,；如果<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">是 AX545 的开发板，需选择的 DDR3 型号为 MT41J128M16XX-187E。</span></span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">设置输出阻抗值和内部的 ODT 内部上拉电阻值来改善 DDR3 的信号完整性，一般<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">不需要修改。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">根据需要可以选择不同的用户端接口方式，可以选择多个 Port, 也可以组合成一个<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">Port, 我们这里选择 One 128-bit bidirectional Port。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">选择 RZQ 和 ZIO 的引脚分配，这跟硬件电路设计有关，不要设置错误。</span><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">在我们的 AX516<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">和 AX545 的开发板上 C2 脚作为 RZQ, L6 脚作为 ZIO。另外选择 Debug Signals for Memory<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">Controller 项设置为 Enable，因为我们将用 chipscope 来测试 DDR3。 System Clock 设置<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">为 Single-Ended。</span></span></span></span></li></ol><div><span style="font-size: 12pt;"><br/></span></div><div><b>目录结构：</b></div><ul><li><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">example_design 文件夹的内容为 MIG 的例子设计，用户可以直接生成 ISE 工程来测试 DDR3<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">的性能。</span></span></b></li><li><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">user_design 中是只有的软核源码，用户还需要编写顶层文件实例化 MIG 的 IP。</span></span></b></li><li><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">在<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">本实验中，我们只用 example_design 的例子来测试 DDR3, user_design 部分在其它工程例<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">子中使用到的时候我们会讲。</span></span></span></span></b></li></ul><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-family: 微软雅黑, Bold; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><b>工程生成和修改：</b></span></div><div><b><br/></b></div><div><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">不再用 ISE 里新建 Project， 直接利用其 MIG 生成相应的.ise 的工程文件。</span></b></div><ol><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">在 exmaple_design 和 user_design 目录下 Par 文件夹里，包含两个.bat 的批处理文件<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">(creat_ise.bat 与 ise_flow.bat),我们用 creat_ise.bat 文件用来生成相应的 ISE 工程文件。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">打开 Xilinx ISE Design Suite 14.7-&gt;Accessories-&gt;ISE Design Suite 64 Bit Command<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">Prompt。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">输入以下命令跳转到 example_design 的 par 目录下。</span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">输入 create_ise 命令，开始运行 par 目录下的 create_ise.bat 批处理生成 ISE 的工程文件。</span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">系统会自动生成相应的 test.xise，此工程里面包含 Mig 生成的所有.v 文件以及相应的.ucf<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">文件。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">生成完成后再用 ISE 打开 PAR 目录下生成的 test.xise 工程。</span></li></ol><div><span style="font-size: 12pt;"><br/></span></div><div><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">修改 UCF 文件</span></b></div><div><b><br/></b></div><ol><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">23 VCCAUX 的电压修改为 3.3V</span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">39 NET “c?_pll_lock”TIG 屏蔽掉。</span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">58 修改系统时钟输入的周期为 20ns, 这需要跟开发板上的晶振频率一样。</span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">74 修改状态信号为四个，分别定义到开发板上的四个 LED 灯，用 LED 灯的状态来显示程序<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">工作状态。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">102 修改 c3_sys_clk 的电压为 LVCMOS33，因为开发板上晶振的输入脚所在的 FPGA Bank<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">的 IO 电压为 3.3V。</span></span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">152 修改 c3_sys_clk 和 c3_sys_rst_i 的管脚约束, 配置成跟开发板的上时钟输入和复位一致。</span></li></ol><div><br/></div><div><b><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">修改顶层文件 example_top.v</span></b></div><div><b><br/></b></div><ol><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">89 Reset 的极性修改为跟开发板电路一致， 低电平有效。</span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">108 增加两个输出 port（ pll_locked 和 heartbeat） 用于连接 LED3 和 LED4</span></li><li><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">150 修改锁相环时钟的频率。</span> <span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">DDR3 的时钟频率，</span><span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">它是按照<b>输入时钟</b>也是 312.5Mhz 来计算的。因<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">为我们开发板上的时钟输入为 50Mhz, 且DDR3 是上下沿采样，这样 FPGA 内部的 DDR3<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">控制器的时钟需要625MHz，所以这里我们需要倍频25, 再分频2，得到 625Mhz 的 CLKOUT0<span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">和 CLKOUT1， 再分频 8 分别得到 user interface 的时钟和 calibration 的时钟 78.125Mhz。</span></span></span></span></li></ol><div><br/></div><div>          localparam C3_CLKOUT0_DIVIDE       = 1;                //625</div><div>          localparam C3_CLKOUT1_DIVIDE       = 1;               // 625</div><div>          localparam C3_CLKOUT2_DIVIDE       = 8;                //625/8=78.125 <span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">user interface</span></span></span></span></div><div>          localparam C3_CLKOUT3_DIVIDE       = 8;               // 625/8=78.125 <span style="font-family: 微软雅黑; color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;"><span style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal;">calibration</span></span></span></span></div><div><br/></div><div>          localparam C3_CLKOUT4_DIVIDE       = 50;             // SPI sd clock 6.25MHz</div><div>          localparam C3_CLKOUT5_DIVIDE       = 10;              // vga clock 50X25/2/10=62.5MHz   </div><div><br/></div><div>          localparam C3_CLKFBOUT_MULT       = 25;             // ddr clock 50*25/2 =  625Mhz   </div><div>          localparam C3_DIVCLK_DIVIDE          = 2;       </div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><br/></span></div></span>
</div></body></html> 